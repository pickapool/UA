// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace UA.Dialogs
{
    #line default
    using global::System;
    using global::System.Collections.Generic;
    using global::System.Linq;
    using global::System.Threading.Tasks;
    using global::Microsoft.AspNetCore.Components;
#nullable restore
#line (1,2)-(1,23) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using System.Net.Http

#nullable disable
    ;
#nullable restore
#line (2,2)-(2,28) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using System.Net.Http.Json

#nullable disable
    ;
#nullable restore
#line (3,2)-(3,45) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms

#nullable disable
    ;
#nullable restore
#line (4,2)-(4,47) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing

#nullable disable
    ;
#nullable restore
#line (5,2)-(5,43) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Web

#nullable disable
    ;
#nullable restore
#line (6,2)-(6,58) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization

#nullable disable
    ;
#nullable restore
#line (7,2)-(7,56) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http

#nullable disable
    ;
#nullable restore
#line (8,2)-(8,27) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.JSInterop

#nullable disable
    ;
#nullable restore
#line (9,2)-(9,10) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA

#nullable disable
    ;
#nullable restore
#line (10,2)-(10,17) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Shared

#nullable disable
    ;
#nullable restore
#line (11,2)-(11,53) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization

#nullable disable
    ;
#nullable restore
#line (12,2)-(12,42) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Authorization

#nullable disable
    ;
#nullable restore
#line (13,2)-(13,49) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using System.Runtime.InteropServices.JavaScript

#nullable disable
    ;
#nullable restore
#line (15,2)-(15,29) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Blazored.LocalStorage

#nullable disable
    ;
#nullable restore
#line (16,2)-(16,17) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using MudBlazor

#nullable disable
    ;
#nullable restore
#line (17,2)-(17,26) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Blazored.Typeahead

#nullable disable
    ;
#nullable restore
#line (18,2)-(18,27) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using MudBlazor.Utilities

#nullable disable
    ;
#nullable restore
#line (19,2)-(19,20) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using IronBarCode;

#nullable disable
#nullable restore
#line (20,2)-(20,21) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using OfficeOpenXml

#nullable disable
    ;
#nullable restore
#line (22,2)-(22,21) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Components

#nullable disable
    ;
#nullable restore
#line (23,2)-(23,17) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Common

#nullable disable
    ;
#nullable restore
#line (24,2)-(24,16) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Enums

#nullable disable
    ;
#nullable restore
#line (25,2)-(25,17) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Models

#nullable disable
    ;
#nullable restore
#line (26,2)-(26,18) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Dialogs

#nullable disable
    ;
#nullable restore
#line (28,2)-(28,35) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.AccountServices

#nullable disable
    ;
#nullable restore
#line (29,2)-(29,38) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.DepartmentServices

#nullable disable
    ;
#nullable restore
#line (30,2)-(30,36) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.SanctionServices

#nullable disable
    ;
#nullable restore
#line (31,2)-(31,34) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.CourseServices

#nullable disable
    ;
#nullable restore
#line (32,2)-(32,35) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.SectionServices

#nullable disable
    ;
#nullable restore
#line (33,2)-(33,35) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.StudentServices

#nullable disable
    ;
#nullable restore
#line (34,2)-(34,40) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.UserSanctionServices

#nullable disable
    ;
#nullable restore
#line (35,2)-(35,44) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.DepartmentCourseServices

#nullable disable
    ;
#nullable restore
#line (36,2)-(36,34) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.ReportServices

#nullable disable
    ;
#nullable restore
#line (37,2)-(37,33) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.EventServices

#nullable disable
    ;
#nullable restore
#line (38,2)-(38,43) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.EventAttendanceServices

#nullable disable
    ;
#nullable restore
#line (39,2)-(39,36) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.ReminderServices

#nullable disable
    ;
#nullable restore
#line (41,2)-(41,43) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.SignalR.Client

#nullable disable
    ;
    #line default
    #line hidden
    #nullable restore
    public partial class ExportDialog : global::Microsoft.AspNetCore.Components.ComponentBase
    #nullable disable
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line (106,2)-(273,1) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Dialogs\ExportDialog.razor"

    [CascadingParameter] public MudDialogInstance MudDialog { get; set; } = default!;
    private bool IsLoading = true, reload = false;
    private List<CourseModel> courses = new(), currentCourse = new();
    private List<DepartmentModel> departments = new();
    private List<SanctionModel> sanctions = new();
    private List<SectionModel> sections = new();
    private DepartmentModel Department = new();
    private CourseModel Course = new();
    private SectionModel Section = new();
    private Enums.YearLevel YearLevel;
    List<StudentModel> Students = new();
    
    IList<IBrowserFile> files = new List<IBrowserFile>();

    protected override async Task OnInitializedAsync()
    {
        Task t = GetList();
        await t;
        if(t.Status == TaskStatus.RanToCompletion)
        {
            IsLoading = false;
            StateHasChanged();
        }
    }
    private async Task DepartmentChange(DepartmentModel m)
    {
        reload = false;
        Task<List<DepartmentCourseModel>> list = departmentCourseService.ListOfDepartmentCourse(
        new FilterParameter
            {
                DepartmentId = m.DepartmentId
            });
        await list;
        if (list.Status == TaskStatus.RanToCompletion)
        {
            currentCourse = courses.Where(d => list.Result.Any(dc => dc.CourseId == d.CourseId)).ToList();
            reload = true;
            StateHasChanged();
        }
    }
    private async Task GetList()
    {
        departments = await departmentService.ListOfDepartment(new FilterParameter());
        courses = await courseService.ListOfCourse(new FilterParameter());
        sections = await sectionService.ListOfSection(new FilterParameter());
        await DepartmentChange(departments.FirstOrDefault());
        StateHasChanged();
        // await Task.Delay(1500);
    }
    void Cancel()
    {
        MudDialog.Cancel();
    }
    private async Task UploadFiles2(IBrowserFile file)
    {
        files.Clear();
        Students.Clear();
        files.Add(file);
        
        //TODO upload the files to the server

        string filePath = Path.Combine(Path.GetTempPath(), file.Name);
        
        // Save the file to the temporary location
        using (FileStream fileStream = File.Create(filePath))
        {
            await file.OpenReadStream(209715200).CopyToAsync(fileStream);
        }

        // Read the Excel file and extract values per column
        try
        {
            //Fixes
            ExcelPackage.LicenseContext = LicenseContext.NonCommercial;
            //End Fixes
            using (ExcelPackage package = new ExcelPackage(new FileInfo(filePath)))
            {
                ExcelWorksheet worksheet = package.Workbook.Worksheets.FirstOrDefault(); // Get the first worksheet

                if (worksheet != null)
                {
                    int rowCount = worksheet.Dimension.Rows;
                    int columnCount = worksheet.Dimension.Columns;

                    // Loop through each row
                    for (int row = 1; row <= rowCount; row++)
                    {
                        StudentModel stud = new StudentModel();

                        for (int col = 1; col <= columnCount; col++)
                        {
                            object cellValue = worksheet.Cells[row, col].Value;
                            string cellText = cellValue?.ToString() ?? string.Empty;

                            // Assign cell values to StudentModel properties based on column index
                            switch (col)
                            {
                                case 1:
                                    stud.QRCode = cellText;
                                    break;
                                case 2:
                                    stud.IdNo = cellText;
                                    break;
                                case 3:
                                    stud.StudentName = cellText;
                                    break;
                                default:
                                    // Handle additional columns if needed
                                    break;
                            }
                        }

                        Students.Add(stud);
                    }
                }
                else
                {
                    // Handle case where no worksheet is found
                    Console.WriteLine("No worksheet found in the Excel file.");
                }
            }
        }
        catch (Exception ex)
        {
            // Handle any exceptions that occur during file reading
            Console.WriteLine("An error occurred while reading the Excel file: " + ex.Message);
        }
        // Clean up: delete the temporary file
        File.Delete(filePath);

     }
    private void MapStudents()
    {
        Students.ForEach( s => {
            s.DepartmentId = Department.DepartmentId;
            s.CourseId = Course.CourseId;
            s.SectionId = Section.SectionId;
            s.YearLevel = YearLevel;
        });
    }
    private async Task Save()
    {
        MapStudents();
        int count = 0;
        IsLoading = true;
        StateHasChanged();
        foreach(var student in Students)
        {
            IsLoading = true;
            Task t = studentService.AddStudent(student);
            await t;
            if(t.Status == TaskStatus.RanToCompletion)
            {
                count++;
                if(count == Students.Count)
                {
                    IsLoading = false;
                    Extensions.ShowAlert("Successfully imported!", Variant.Filled, SnackbarService, Severity.Success);
                }
            } else {
                IsLoading = false;
                Extensions.ShowAlert("There was a problem while importing!", Variant.Filled, SnackbarService, Severity.Error);
            }
        }
        
    }

#line default
#line hidden
#nullable disable

        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (6,9)-(6,18) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Dialogs\ExportDialog.razor"
ISnackbar

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (6,19)-(6,34) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Dialogs\ExportDialog.razor"
SnackbarService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (5,9)-(5,24) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Dialogs\ExportDialog.razor"
IStudentService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (5,25)-(5,39) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Dialogs\ExportDialog.razor"
studentService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (4,9)-(4,33) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Dialogs\ExportDialog.razor"
IDepartmentCourseService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (4,34)-(4,57) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Dialogs\ExportDialog.razor"
departmentCourseService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (3,9)-(3,24) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Dialogs\ExportDialog.razor"
ISectionService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (3,25)-(3,39) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Dialogs\ExportDialog.razor"
sectionService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (2,9)-(2,23) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Dialogs\ExportDialog.razor"
ICourseService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (2,24)-(2,37) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Dialogs\ExportDialog.razor"
courseService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (1,9)-(1,27) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Dialogs\ExportDialog.razor"
IDepartmentService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (1,28)-(1,45) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Dialogs\ExportDialog.razor"
departmentService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
    }
}
#pragma warning restore 1591
