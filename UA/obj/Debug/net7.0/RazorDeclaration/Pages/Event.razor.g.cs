// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace UA.Pages
{
    #line default
    using global::System;
    using global::System.Collections.Generic;
    using global::System.Linq;
    using global::System.Threading.Tasks;
    using global::Microsoft.AspNetCore.Components;
#nullable restore
#line (1,2)-(1,23) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using System.Net.Http

#nullable disable
    ;
#nullable restore
#line (2,2)-(2,28) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using System.Net.Http.Json

#nullable disable
    ;
#nullable restore
#line (3,2)-(3,45) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms

#nullable disable
    ;
#nullable restore
#line (4,2)-(4,47) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing

#nullable disable
    ;
#nullable restore
#line (5,2)-(5,43) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Web

#nullable disable
    ;
#nullable restore
#line (6,2)-(6,58) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization

#nullable disable
    ;
#nullable restore
#line (7,2)-(7,56) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http

#nullable disable
    ;
#nullable restore
#line (8,2)-(8,27) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.JSInterop

#nullable disable
    ;
#nullable restore
#line (9,2)-(9,10) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA

#nullable disable
    ;
#nullable restore
#line (10,2)-(10,17) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Shared

#nullable disable
    ;
#nullable restore
#line (11,2)-(11,53) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization

#nullable disable
    ;
#nullable restore
#line (12,2)-(12,42) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Authorization

#nullable disable
    ;
#nullable restore
#line (13,2)-(13,49) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using System.Runtime.InteropServices.JavaScript

#nullable disable
    ;
#nullable restore
#line (15,2)-(15,29) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Blazored.LocalStorage

#nullable disable
    ;
#nullable restore
#line (16,2)-(16,17) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using MudBlazor

#nullable disable
    ;
#nullable restore
#line (17,2)-(17,26) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Blazored.Typeahead

#nullable disable
    ;
#nullable restore
#line (18,2)-(18,27) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using MudBlazor.Utilities

#nullable disable
    ;
#nullable restore
#line (19,2)-(19,20) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using IronBarCode;

#nullable disable
#nullable restore
#line (20,2)-(20,21) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using OfficeOpenXml

#nullable disable
    ;
#nullable restore
#line (22,2)-(22,21) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Components

#nullable disable
    ;
#nullable restore
#line (23,2)-(23,17) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Common

#nullable disable
    ;
#nullable restore
#line (24,2)-(24,16) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Enums

#nullable disable
    ;
#nullable restore
#line (25,2)-(25,17) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Models

#nullable disable
    ;
#nullable restore
#line (26,2)-(26,18) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Dialogs

#nullable disable
    ;
#nullable restore
#line (28,2)-(28,35) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.AccountServices

#nullable disable
    ;
#nullable restore
#line (29,2)-(29,38) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.DepartmentServices

#nullable disable
    ;
#nullable restore
#line (30,2)-(30,36) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.SanctionServices

#nullable disable
    ;
#nullable restore
#line (31,2)-(31,34) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.CourseServices

#nullable disable
    ;
#nullable restore
#line (32,2)-(32,35) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.SectionServices

#nullable disable
    ;
#nullable restore
#line (33,2)-(33,35) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.StudentServices

#nullable disable
    ;
#nullable restore
#line (34,2)-(34,40) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.UserSanctionServices

#nullable disable
    ;
#nullable restore
#line (35,2)-(35,44) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.DepartmentCourseServices

#nullable disable
    ;
#nullable restore
#line (36,2)-(36,34) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.ReportServices

#nullable disable
    ;
#nullable restore
#line (37,2)-(37,33) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.EventServices

#nullable disable
    ;
#nullable restore
#line (38,2)-(38,43) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.EventAttendanceServices

#nullable disable
    ;
#nullable restore
#line (39,2)-(39,36) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.ReminderServices

#nullable disable
    ;
#nullable restore
#line (41,2)-(41,43) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.SignalR.Client

#nullable disable
    ;
    #line default
    #line hidden
    [global::Microsoft.AspNetCore.Components.RouteAttribute(
    // language=Route,Component
#nullable restore
#line (1,7)-(1,16) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
"/events"

#line default
#line hidden
#nullable disable
    )]
    #nullable restore
    public partial class Event : global::Microsoft.AspNetCore.Components.ComponentBase
    #nullable disable
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line (150,2)-(275,1) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"

    List<EventModel> list = new();
    private int[] pageSize = new int[] {30, 50, 100, 500, 1000 };
    private string searchTerm = string.Empty;
    private bool IsLoading = true;
    public bool _isOpen;
    IEnumerable<SanctionModel> sanctions;
    SanctionModel currentSanction = new();
    EventModel currentEvent = new();

    protected override async Task OnInitializedAsync()
    {
        await GetList(new());
        sanctions = await SanctionService.ListOfSanction(new FilterParameter());
        currentSanction = sanctions.ToList().Where( e => e.SanctionName.Contains("Attendance", StringComparison.CurrentCultureIgnoreCase)).FirstOrDefault();
    }   
    private async Task GetAttendance(EventModel events)
    {
        currentEvent = events;
        if(events.ShowAttendance)
        {
            events.ShowAttendance = false;
            StateHasChanged();
            return;
        }
        foreach(EventModel e in list)
        {
            e.ShowAttendance =false;
            StateHasChanged();
        }
        FilterParameter param = new();
        param.EventId = events.EventId;
        events.ListAttendance = await EventAttendanceService.ListOfEventAttendance(param);
        events.ListAttendance.RemoveAll( e => e.Student.StudentId == 0);
        List<StudentModel> students = await StudentService.ListOfStudent(new());
        events.ListAttendance = events.ListAttendance.DistinctBy( e => e.Student.StudentId).ToList();
        events.ListAbsent = students.Where(student => 
            !events.ListAttendance.Any(attendance => attendance.StudentId == student.StudentId))
            .ToList();
        events.ShowAttendance = true;
        StateHasChanged();
    }
    private async Task GetList(FilterParameter filterParameter)
    {
        list = await EventService.ListOfEvent(filterParameter);
        var a = await EventAttendanceService.ListOfEventAttendance(filterParameter);
        Console.WriteLine(Newtonsoft.Json.JsonConvert.SerializeObject(a, Newtonsoft.Json.Formatting.Indented));
        IsLoading = false;
    }
    private bool FilterItems(EventModel items)
    {
        if (string.IsNullOrEmpty(searchTerm))
            return true;
        if (items.EventName.Contains(searchTerm, StringComparison.InvariantCultureIgnoreCase))
            return true;
        return false;
    }
    private async Task OpenDialog(EventModel dept)
    {
        var parameters = new DialogParameters();
        parameters.Add("color", dept.EventId == 0 ? Color.Info : Color.Success);
        parameters.Add("dialogTitle", dept.EventId == 0 ? "Add Event" : "Edit Event");
        parameters.Add("buttonText", dept.EventId == 0 ? "Add" : "Save");
        parameters.Add("Event", dept);
        MaxWidth width = MaxWidth.ExtraSmall;
        var options = new DialogOptions() { CloseButton = false, MaxWidth = width, FullWidth = true, NoHeader = false, DisableBackdropClick = true };
        var resultDialog = await dialogService.Show<Dialogs.AddEventDialog>("", parameters, options).Result;
        if (!resultDialog.Canceled)
        {
            await GetList(new FilterParameter());
        } else {
            await GetList(new FilterParameter());
        }
    }
     private async Task DeleteEvent(int id)
    {
        var parameters = new DialogParameters<Confirmation>();
        parameters.Add("ContentText", "Do you really want to delete these record? This process cannot be undone.");
        parameters.Add("ButtonText", "Yes");
        parameters.Add("Color", Color.Error);

        var options = new DialogOptions() { CloseButton = true, MaxWidth = MaxWidth.ExtraSmall };

        var dialog = await dialogService.Show<Confirmation>("Delete", parameters, options).Result;
        if(!dialog.Canceled)
        {
            IsLoading = !IsLoading;
            Task t = EventService.DeleteEvent(id);
            await t;
            if(t.Status == TaskStatus.RanToCompletion)
            {
                await GetList(new FilterParameter());
                Extensions.ShowAlert("Event successfully remove.", Variant.Filled, Snackbar, Severity.Success);
            }
        }
    }
    private async Task AddALLSanction()
    {
        foreach(StudentModel stud in currentEvent.ListAbsent)
        {
            await AddSanction(stud);
        }
    }
    private async Task AddSanction(StudentModel student)
    {
        if(currentSanction == null)
        {
            Extensions.ShowAlert("Sanction named (Attendance) not found!", Variant.Filled, Snackbar, Severity.Error);
            return;
        }
        UserSanctionModel userSanc  = new();
        userSanc.StudentId = student.StudentId;
        userSanc.SanctionId = currentSanction.SanctionId;
        userSanc.Sanction.SanctionId = currentSanction.SanctionId;
        userSanc.Sanction.SanctionName = currentSanction.SanctionName;
        userSanc.Amount = currentSanction.Amount;
        userSanc.UserId = GlobalClass.Account.UserId;
        userSanc.MarkAsPaidById = 1;
        Task<UserSanctionModel> task = UserSanctionService.AddUserSanction(userSanc);
        await task;
        if(task.Status == TaskStatus.RanToCompletion)
        {
            Extensions.ShowAlert("Sanction successfully added.", Variant.Filled, Snackbar, Severity.Success);
        }
    }

#line default
#line hidden
#nullable disable

        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (10,9)-(10,18) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
ISnackbar

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (10,19)-(10,27) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
Snackbar

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (9,9)-(9,29) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
IUserSanctionService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (9,30)-(9,49) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
UserSanctionService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (8,9)-(8,25) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
ISanctionService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (8,26)-(8,41) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
SanctionService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (7,9)-(7,24) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
IStudentService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (7,25)-(7,39) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
StudentService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (5,9)-(5,32) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
IEventAttendanceService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (5,33)-(5,55) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
EventAttendanceService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (4,9)-(4,23) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
IDialogService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (4,24)-(4,37) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
dialogService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (3,9)-(3,22) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
IEventService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (3,23)-(3,35) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\Event.razor"
EventService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
    }
}
#pragma warning restore 1591
