// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace UA.Pages
{
    #line default
    using global::System;
    using global::System.Collections.Generic;
    using global::System.Linq;
    using global::System.Threading.Tasks;
    using global::Microsoft.AspNetCore.Components;
#nullable restore
#line (1,2)-(1,23) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using System.Net.Http

#nullable disable
    ;
#nullable restore
#line (2,2)-(2,28) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using System.Net.Http.Json

#nullable disable
    ;
#nullable restore
#line (3,2)-(3,45) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms

#nullable disable
    ;
#nullable restore
#line (4,2)-(4,47) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing

#nullable disable
    ;
#nullable restore
#line (5,2)-(5,43) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Web

#nullable disable
    ;
#nullable restore
#line (6,2)-(6,58) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization

#nullable disable
    ;
#nullable restore
#line (7,2)-(7,56) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http

#nullable disable
    ;
#nullable restore
#line (8,2)-(8,27) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.JSInterop

#nullable disable
    ;
#nullable restore
#line (9,2)-(9,10) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA

#nullable disable
    ;
#nullable restore
#line (10,2)-(10,17) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Shared

#nullable disable
    ;
#nullable restore
#line (11,2)-(11,53) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization

#nullable disable
    ;
#nullable restore
#line (12,2)-(12,42) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.Authorization

#nullable disable
    ;
#nullable restore
#line (13,2)-(13,49) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using System.Runtime.InteropServices.JavaScript

#nullable disable
    ;
#nullable restore
#line (15,2)-(15,29) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Blazored.LocalStorage

#nullable disable
    ;
#nullable restore
#line (16,2)-(16,17) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using MudBlazor

#nullable disable
    ;
#nullable restore
#line (17,2)-(17,26) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Blazored.Typeahead

#nullable disable
    ;
#nullable restore
#line (18,2)-(18,27) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using MudBlazor.Utilities

#nullable disable
    ;
#nullable restore
#line (19,2)-(19,20) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using IronBarCode;

#nullable disable
#nullable restore
#line (20,2)-(20,21) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using OfficeOpenXml

#nullable disable
    ;
#nullable restore
#line (22,2)-(22,21) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Components

#nullable disable
    ;
#nullable restore
#line (23,2)-(23,17) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Common

#nullable disable
    ;
#nullable restore
#line (24,2)-(24,16) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Enums

#nullable disable
    ;
#nullable restore
#line (25,2)-(25,17) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Models

#nullable disable
    ;
#nullable restore
#line (26,2)-(26,18) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Dialogs

#nullable disable
    ;
#nullable restore
#line (28,2)-(28,35) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.AccountServices

#nullable disable
    ;
#nullable restore
#line (29,2)-(29,38) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.DepartmentServices

#nullable disable
    ;
#nullable restore
#line (30,2)-(30,36) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.SanctionServices

#nullable disable
    ;
#nullable restore
#line (31,2)-(31,34) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.CourseServices

#nullable disable
    ;
#nullable restore
#line (32,2)-(32,35) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.SectionServices

#nullable disable
    ;
#nullable restore
#line (33,2)-(33,35) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.StudentServices

#nullable disable
    ;
#nullable restore
#line (34,2)-(34,40) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.UserSanctionServices

#nullable disable
    ;
#nullable restore
#line (35,2)-(35,44) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.DepartmentCourseServices

#nullable disable
    ;
#nullable restore
#line (36,2)-(36,34) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.ReportServices

#nullable disable
    ;
#nullable restore
#line (37,2)-(37,33) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.EventServices

#nullable disable
    ;
#nullable restore
#line (38,2)-(38,43) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.EventAttendanceServices

#nullable disable
    ;
#nullable restore
#line (39,2)-(39,36) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using UA.Services.ReminderServices

#nullable disable
    ;
#nullable restore
#line (41,2)-(41,43) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\_Imports.razor"
using Microsoft.AspNetCore.SignalR.Client

#nullable disable
    ;
    #line default
    #line hidden
    [global::Microsoft.AspNetCore.Components.RouteAttribute(
    // language=Route,Component
#nullable restore
#line (1,7)-(1,18) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\College.razor"
"/colleges"

#line default
#line hidden
#nullable disable
    )]
    #nullable restore
    public partial class College : global::Microsoft.AspNetCore.Components.ComponentBase
    #nullable disable
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line (301,8)-(505,1) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\College.razor"


    private int[] pageSize = new int[] { 30, 50, 100, 500, 1000 };
    private bool IsLoading = true, IsPrint = false;
    private List<DepartmentModel> departments = new();
    private List<DepartmentModel> masterList = new();
    private string PDF = string.Empty;
    private FilterParameter parameter = new();
    private bool _isOpen;
    private DateRange _dateRange = new DateRange(DateTime.Now.Date, DateTime.Now.AddDays(5).Date);
    private IEnumerable<CourseModel> hasCourse {get; set;} = new HashSet<CourseModel>();
    private CourseModel selectedCourse = new();
    private List<CourseModel> courseList = new();
    private IEnumerable<DepartmentModel> hasDepartment {get; set;} = new HashSet<DepartmentModel>();
    private DepartmentModel selectedDepartment = new();
    private List<DepartmentModel> departmentList = new();
    private IEnumerable<SectionModel> hasSection {get; set;} = new HashSet<SectionModel>();
    private SectionModel selectedSection = new();
    private List<SectionModel> sectionList = new();
    private IEnumerable<Enums.YearLevel> hasYear {get; set;} = new HashSet<Enums.YearLevel>();
    private Enums.YearLevel selectedYear = new();
    private List<Enums.YearLevel> yearList = new();
    private IEnumerable<SanctionModel> hasSanction {get; set;} = new HashSet<SanctionModel>();
    private SanctionModel selectedSanction = new();
    private List<SanctionModel> sanctionList = new();
    protected override async Task OnInitializedAsync()
    {
        GlobalClass.pageTitle = "Colleges";
        Task t = Task.WhenAll(GetDepartments(), Filter(0, true));
        await t;
        if (t.Status == TaskStatus.RanToCompletion)
        {
            IsLoading = !IsLoading;
            IsPrint = false;
            StateHasChanged();
        }

    }
    private async Task GetDepartments()
    {
        departments = await DepartmentService.ListOfDepartment(new FilterParameter());
        int count = 0;
        departments.ForEach(d =>
        {
            d.C = count++;
            if (count.Equals(departments.Count))
                count = 0;
        });
        courseList = GlobalClass.ListOfCourse = await CourseService.ListOfCourse(new FilterParameter());
        sectionList = GlobalClass.ListOfSections = await SectionService.ListOfSection(new FilterParameter());
        departmentList = GlobalClass.ListOfDepartments = departments;
        await Sanctions();
    }
    private async Task Filter(int departmnetId, bool IsRefresh) {
        parameter.DepartmentId = departmnetId;
        if(IsRefresh) parameter = new();
        IsLoading = !IsLoading;
        Task<List<DepartmentModel>> list = DepartmentService.CollegesMasterList(parameter);
        await list;
        if (list.Status == TaskStatus.RanToCompletion)
        {
            masterList = list.Result;
            masterList.ForEach( e => e.IsOpenDeparment = true);
            masterList.ForEach( e => e.Courses.ForEach( e => e.Course.Students.ForEach( e=> { e.Course = new(); e.Department = new(); })));
            IsLoading = !IsLoading;
            StateHasChanged();
        }
    }
    private async Task PrintPDF()
    {
        //list = masterList.SelectMany(d => d.Courses.SelectMany(c => c.Course.Students)).ToList();
        List<StudentModel> list = new List<StudentModel>();
        foreach (var department in masterList)
        {
            foreach (var course in department.Courses)
            {
                foreach (var student in course.Course.Students)
                {
                    foreach (var sanction in student.Sanctions)
                    {
                        StudentModel studentModel = new StudentModel
                        {
                            // Copy properties from the original student
                            IdNo = student.IdNo,
                            StudentId = student.StudentId,
                            StudentName = student.StudentName,
                            CourseId = student.CourseId,
                            DepartmentId = student.DepartmentId,
                            SectionId = student.SectionId,
                            QRCode = student.QRCode,
                            YearLevel = student.YearLevel,
                            // Additional properties from other sources
                            Departmentname = GlobalClass.ListOfDepartments.FirstOrDefault(d => d.DepartmentId == student.DepartmentId)?.DepartmentName,
                            SectionName = GlobalClass.ListOfSections.FirstOrDefault(s => s.SectionId == student.SectionId)?.SectionName,
                            CourseName = GlobalClass.ListOfCourse.FirstOrDefault(c => c.CourseId == student.CourseId)?.CourseName,
                            SanctionAmount = sanction.Amount,
                            DateRecorded = sanction.DateRecorded,
                            SanctionName = sanction.Sanction.SanctionName,
                            IsPaid = sanction.IsPaid
                        };
                        
                        list.Add(studentModel);
                    }
                }
            }
        }
       //list.RemoveAll( e => String.IsNullOrEmpty(e.Departmentname));
        
        Task<string> t = ReportService.GetMasterListReport(list);
        await t;
        if(t.Status == TaskStatus.RanToCompletion)
        {
            PDF = t.Result;
            IsPrint = !IsPrint;
            StateHasChanged();
        }
        
    }
    
    public void Toggle()
    {
        if (_isOpen)
            _isOpen = false;
        else
            _isOpen = true;
    }
    private string SelectedCourse(List<string> selectedCourse)
    {
        var course = "";
        foreach (var item in hasCourse)
        {
        course = string.Join(", ", hasCourse.Select(x => x.CourseName));      
        }
        return $"{course}";
    }
    private string SelectedSection(List<string> selectedSection)
    {
        var sec = "";
        foreach (var item in hasSection)
        {
        sec = string.Join(", ", hasSection.Select(x => x.SectionName));      
        }
        return $"{sec}";
    }
    private string SelectedDepartment(List<string> selectedDepartment)
    {
        var dept = "";
        foreach (var item in hasDepartment)
        {
        dept = string.Join(", ", hasDepartment.Select(x => x.DepartmentName));      
        }
        return $"{dept}";
    }
    private string SelectedYear(List<string> selectedYear)
    {
        var year = "";
        foreach (var item in hasYear)
        {
        year = string.Join(", ", hasYear.Select(x => x));      
        }
        return $"{year}";
    }
    private string SelectedSanction(List<string> selectedSanction)
    {
        var sanc = "";
        foreach (var item in hasSanction)
        {
            sanc = string.Join(", ", hasSanction.Select(x => x.SanctionName));      
        }
        return $"{sanc}";
    }
    private async Task Sanctions()
    {
        sanctionList = await sanctionService.ListOfSanction(new FilterParameter());
    }
    public async Task Filter()
    {
        if(parameter.IsDate)
        {
            parameter.DateFrom = Convert.ToDateTime(_dateRange.Start);
            parameter.DateTo = Convert.ToDateTime(_dateRange.End);
        }
        if(parameter.IsCourse)
        {
            parameter.Courses = hasCourse.ToList();
        }
        if(parameter.IsDepartment)
        {
            parameter.Departments = hasDepartment.ToList();
        }
        if(parameter.IsSection)
        {
            parameter.Sections = hasSection.ToList();
        }
        if(parameter.IsYear)
        {
            parameter.YearLevels = hasYear.ToList();
        }
        if(parameter.IsSanction)
        {
            parameter.Sanctions = hasSanction.ToList();
        }
        await Filter(0, false);
    }

#line default
#line hidden
#nullable disable

        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (7,9)-(7,25) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\College.razor"
ISanctionService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (7,26)-(7,41) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\College.razor"
sanctionService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (6,9)-(6,24) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\College.razor"
ISectionService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (6,25)-(6,39) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\College.razor"
SectionService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (5,9)-(5,23) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\College.razor"
ICourseService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (5,24)-(5,37) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\College.razor"
CourseService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (4,9)-(4,23) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\College.razor"
IReportService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (4,24)-(4,37) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\College.razor"
ReportService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private 
#nullable restore
#line (3,9)-(3,27) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\College.razor"
IDepartmentService

#line default
#line hidden
#nullable disable
         
#nullable restore
#line (3,28)-(3,45) "C:\Users\User\Desktop\Projects\Blazor Projects\UA\UA\Pages\College.razor"
DepartmentService

#line default
#line hidden
#nullable disable
         { get; set; }
         = default!;
    }
}
#pragma warning restore 1591
